{% load static %}

<footer>
    <div class="footer-top">
      <a href="#top">Back to top</a>
    </div>
    <div class="footer-middle">
      <div>
        <img src="{% static 'images/mainlogo.png' %}" alt="ZIpnserve Logo" class="logo-img">
      </div>
      <a href="#help">Help</a>
    </div>
    <div class="footer-bottom">
      <a href="#conditions">Conditions of Use & Sale</a>
      <a href="#privacy">Privacy Notice</a>
      <a href="#ads">Interest-Based Ads</a>
      <p>Â© 2024-2025, Zipnserve.com, Inc. or its affiliates</p>
    </div>
  </footer>

  <!-- scripts -->
      <script src="{% static 'js/jquery-1.11.0.min.js' %}"></script>
      <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
      <script src="{% static 'js/plugins.js' %}"></script>
      <script src="{%  static 'js/script.js' %}"></script>


  <!-- Paypal Intigration-->
    <!-- <script src="https://www.paypal.com/sdk/js?client-id=AWo3zQgh3QfRHJFx17efgnG7LdTnXSOpVjyEKAy2ajr9ENoldjF6y0nwt33kW8B4gCwoV82qlRa0UVVm&buyer-country=US&currency=USD&disable-funding=credit" > </script> -->
    <!-- <script src="{% static 'js/app.js' %}"></script> -->




    <!-- <script src="https://www.paypalobjects.com/api/checkout.js"></script> -->
    
    <!--  This will work ....-->
    
<!--     <script>
  
  var amount = "{{ grand_total }}"; 
  
  
  paypal.Button.render({
    // Configure environment
    env: 'sandbox',
    client: {
      sandbox: 'AWo3zQgh3QfRHJFx17efgnG7LdTnXSOpVjyEKAy2ajr9ENoldjF6y0nwt33kW8B4gCwoV82qlRa0UVVm',
      // production: 'demo_production_client_id'
      },
      // Customize button (optional)
      locale: 'en_US',
      style: {
        size: 'responsive',
        color: 'gold',
        shape: 'rect',
        label: 'pay',
        tagline : 'false',
        },
        
        // Enable Pay Now checkout flow (optional)
        commit: true,
        
      // Set up a payment
      payment: function(data, actions) {
        return actions.payment.create({
          transactions: [{
            amount: {
              total: amount,
              currency: 'USD'
            }
          }]
        });
      },
      // Execute the payment
      onAuthorize: function(data, actions) {
        return actions.payment.execute().then(function() {
          // Show a confirmation message to the buyer
          window.alert('Thank you for your purchase!');
        });
      }
    }, '#paypal-button-container');

</script> -->
   


<script src="https://www.paypal.com/sdk/js?client-id=AWo3zQgh3QfRHJFx17efgnG7LdTnXSOpVjyEKAy2ajr9ENoldjF6y0nwt33kW8B4gCwoV82qlRa0UVVm&currency=USD"></script>


<script>

  function getCookie(name) { // this function is copied from,  Django csrf token documentation . 
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
var amount = "{{ grand_total }}"; 
var url = "{% url 'payment' %}"; // it's a path , where name = payment in payments url.py 
var csrftoken = getCookie('csrftoken');
var orderID ="{{order.order_number}}";
var payment_method ='Paypal';
var redirect_url = "{% url 'order_complete' %}"


  paypal.Buttons({
    style: {
      size: 'responsive',
      color: 'gold',
      shape: 'rect',
      label: 'pay',
      tagline: 'false',
    },

    createOrder: function(data, actions) {
      return actions.order.create({
        purchase_units: [{
          amount: {
            value: amount,
            currency_code: 'USD'
          }
        }]
      });
    },
    onApprove: function(data, actions) {
      return actions.order.capture().then(function(details) {
        console.log(details); // it will print All transation details inside console.
        sendData();
        function sendData(){
          fetch(url,{
            method: "POST",
            headers : {
              "Content-type": "application/json",
              "X-CSRFToken" : csrftoken, // this csrf token comes from above getcookie function ...
            },
            body : JSON.stringify({
              orderID : orderID,
              transID : details.id,
              payment_method: payment_method,
              status: details.status,
            }),
          })
          .then(response => response.json())
          .then((data) => {
            // console.log('Success: ', data);
            // console.log('Transation Completed');
            window.location.href = redirect_url + '?order_number=' + data.order_number + '&payment_id=' + data.transID;

          });

        }
      });
    }
  }).render('#paypal-button-container'); 
</script>
